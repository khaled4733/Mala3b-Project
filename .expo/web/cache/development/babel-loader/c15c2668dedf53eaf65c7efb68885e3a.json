{"ast":null,"code":"'use strict';\n\nimport _objectWithoutProperties from \"@babel/runtime/helpers/objectWithoutProperties\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\nvar _excluded = [\"headers\"];\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nimport Blob from \"../Blob/Blob\";\nimport BlobManager from \"../Blob/BlobManager\";\nimport NativeEventEmitter from \"../EventEmitter/NativeEventEmitter\";\nimport binaryToBase64 from \"../Utilities/binaryToBase64\";\nimport NativeWebSocketModule from \"./NativeWebSocketModule\";\nimport WebSocketEvent from \"./WebSocketEvent\";\nimport base64 from 'base64-js';\nimport EventTarget from 'event-target-shim';\nimport invariant from 'invariant';\nvar CONNECTING = 0;\nvar OPEN = 1;\nvar CLOSING = 2;\nvar CLOSED = 3;\nvar CLOSE_NORMAL = 1000;\nvar WEBSOCKET_EVENTS = ['close', 'error', 'message', 'open'];\nvar nextWebSocketId = 0;\n\nvar WebSocket = function (_ref) {\n  _inherits(WebSocket, _ref);\n\n  var _super = _createSuper(WebSocket);\n\n  function WebSocket(url, protocols, options) {\n    var _this;\n\n    _classCallCheck(this, WebSocket);\n\n    _this = _super.call(this);\n    _this.CONNECTING = CONNECTING;\n    _this.OPEN = OPEN;\n    _this.CLOSING = CLOSING;\n    _this.CLOSED = CLOSED;\n    _this.readyState = CONNECTING;\n\n    if (typeof protocols === 'string') {\n      protocols = [protocols];\n    }\n\n    var _ref2 = options || {},\n        _ref2$headers = _ref2.headers,\n        headers = _ref2$headers === void 0 ? {} : _ref2$headers,\n        unrecognized = _objectWithoutProperties(_ref2, _excluded);\n\n    if (unrecognized && typeof unrecognized.origin === 'string') {\n      console.warn('Specifying `origin` as a WebSocket connection option is deprecated. Include it under `headers` instead.');\n      headers.origin = unrecognized.origin;\n      delete unrecognized.origin;\n    }\n\n    if (Object.keys(unrecognized).length > 0) {\n      console.warn('Unrecognized WebSocket connection option(s) `' + Object.keys(unrecognized).join('`, `') + '`. ' + 'Did you mean to put these under `headers`?');\n    }\n\n    if (!Array.isArray(protocols)) {\n      protocols = null;\n    }\n\n    _this._eventEmitter = new NativeEventEmitter(NativeWebSocketModule);\n    _this._socketId = nextWebSocketId++;\n\n    _this._registerEvents();\n\n    NativeWebSocketModule.connect(url, protocols, {\n      headers: headers\n    }, _this._socketId);\n    return _this;\n  }\n\n  _createClass(WebSocket, [{\n    key: \"binaryType\",\n    get: function get() {\n      return this._binaryType;\n    },\n    set: function set(binaryType) {\n      if (binaryType !== 'blob' && binaryType !== 'arraybuffer') {\n        throw new Error(\"binaryType must be either 'blob' or 'arraybuffer'\");\n      }\n\n      if (this._binaryType === 'blob' || binaryType === 'blob') {\n        invariant(BlobManager.isAvailable, 'Native module BlobModule is required for blob support');\n\n        if (binaryType === 'blob') {\n          BlobManager.addWebSocketHandler(this._socketId);\n        } else {\n          BlobManager.removeWebSocketHandler(this._socketId);\n        }\n      }\n\n      this._binaryType = binaryType;\n    }\n  }, {\n    key: \"close\",\n    value: function close(code, reason) {\n      if (this.readyState === this.CLOSING || this.readyState === this.CLOSED) {\n        return;\n      }\n\n      this.readyState = this.CLOSING;\n\n      this._close(code, reason);\n    }\n  }, {\n    key: \"send\",\n    value: function send(data) {\n      if (this.readyState === this.CONNECTING) {\n        throw new Error('INVALID_STATE_ERR');\n      }\n\n      if (data instanceof Blob) {\n        invariant(BlobManager.isAvailable, 'Native module BlobModule is required for blob support');\n        BlobManager.sendOverSocket(data, this._socketId);\n        return;\n      }\n\n      if (typeof data === 'string') {\n        NativeWebSocketModule.send(data, this._socketId);\n        return;\n      }\n\n      if (data instanceof ArrayBuffer || ArrayBuffer.isView(data)) {\n        NativeWebSocketModule.sendBinary(binaryToBase64(data), this._socketId);\n        return;\n      }\n\n      throw new Error('Unsupported data type');\n    }\n  }, {\n    key: \"ping\",\n    value: function ping() {\n      if (this.readyState === this.CONNECTING) {\n        throw new Error('INVALID_STATE_ERR');\n      }\n\n      NativeWebSocketModule.ping(this._socketId);\n    }\n  }, {\n    key: \"_close\",\n    value: function _close(code, reason) {\n      var statusCode = typeof code === 'number' ? code : CLOSE_NORMAL;\n      var closeReason = typeof reason === 'string' ? reason : '';\n      NativeWebSocketModule.close(statusCode, closeReason, this._socketId);\n\n      if (BlobManager.isAvailable && this._binaryType === 'blob') {\n        BlobManager.removeWebSocketHandler(this._socketId);\n      }\n    }\n  }, {\n    key: \"_unregisterEvents\",\n    value: function _unregisterEvents() {\n      this._subscriptions.forEach(function (e) {\n        return e.remove();\n      });\n\n      this._subscriptions = [];\n    }\n  }, {\n    key: \"_registerEvents\",\n    value: function _registerEvents() {\n      var _this2 = this;\n\n      this._subscriptions = [this._eventEmitter.addListener('websocketMessage', function (ev) {\n        if (ev.id !== _this2._socketId) {\n          return;\n        }\n\n        var data = ev.data;\n\n        switch (ev.type) {\n          case 'binary':\n            data = base64.toByteArray(ev.data).buffer;\n            break;\n\n          case 'blob':\n            data = BlobManager.createFromOptions(ev.data);\n            break;\n        }\n\n        _this2.dispatchEvent(new WebSocketEvent('message', {\n          data: data\n        }));\n      }), this._eventEmitter.addListener('websocketOpen', function (ev) {\n        if (ev.id !== _this2._socketId) {\n          return;\n        }\n\n        _this2.readyState = _this2.OPEN;\n        _this2.protocol = ev.protocol;\n\n        _this2.dispatchEvent(new WebSocketEvent('open'));\n      }), this._eventEmitter.addListener('websocketClosed', function (ev) {\n        if (ev.id !== _this2._socketId) {\n          return;\n        }\n\n        _this2.readyState = _this2.CLOSED;\n\n        _this2.dispatchEvent(new WebSocketEvent('close', {\n          code: ev.code,\n          reason: ev.reason\n        }));\n\n        _this2._unregisterEvents();\n\n        _this2.close();\n      }), this._eventEmitter.addListener('websocketFailed', function (ev) {\n        if (ev.id !== _this2._socketId) {\n          return;\n        }\n\n        _this2.readyState = _this2.CLOSED;\n\n        _this2.dispatchEvent(new WebSocketEvent('error', {\n          message: ev.message\n        }));\n\n        _this2.dispatchEvent(new WebSocketEvent('close', {\n          message: ev.message\n        }));\n\n        _this2._unregisterEvents();\n\n        _this2.close();\n      })];\n    }\n  }]);\n\n  return WebSocket;\n}(EventTarget.apply(void 0, WEBSOCKET_EVENTS));\n\nWebSocket.CONNECTING = CONNECTING;\nWebSocket.OPEN = OPEN;\nWebSocket.CLOSING = CLOSING;\nWebSocket.CLOSED = CLOSED;\nmodule.exports = WebSocket;","map":{"version":3,"sources":["D:/khaled/Matriels/Third Year/Second term/CS303/CS303-Project-1/node_modules/react-native/Libraries/WebSocket/WebSocket.js"],"names":["Blob","BlobManager","NativeEventEmitter","binaryToBase64","NativeWebSocketModule","WebSocketEvent","base64","EventTarget","invariant","CONNECTING","OPEN","CLOSING","CLOSED","CLOSE_NORMAL","WEBSOCKET_EVENTS","nextWebSocketId","WebSocket","url","protocols","options","readyState","headers","unrecognized","origin","console","warn","Object","keys","length","join","Array","isArray","_eventEmitter","_socketId","_registerEvents","connect","_binaryType","binaryType","Error","isAvailable","addWebSocketHandler","removeWebSocketHandler","code","reason","_close","data","sendOverSocket","send","ArrayBuffer","isView","sendBinary","ping","statusCode","closeReason","close","_subscriptions","forEach","e","remove","addListener","ev","id","type","toByteArray","buffer","createFromOptions","dispatchEvent","protocol","_unregisterEvents","message","module","exports"],"mappings":"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","sourcesContent":["/**\r\n * Copyright (c) Facebook, Inc. and its affiliates.\r\n *\r\n * This source code is licensed under the MIT license found in the\r\n * LICENSE file in the root directory of this source tree.\r\n *\r\n * @format\r\n * @flow\r\n */\r\n\r\n'use strict';\r\n\r\nimport Blob from '../Blob/Blob';\r\nimport BlobManager from '../Blob/BlobManager';\r\nimport NativeEventEmitter from '../EventEmitter/NativeEventEmitter';\r\nimport binaryToBase64 from '../Utilities/binaryToBase64';\r\nimport {type EventSubscription} from '../vendor/emitter/EventEmitter';\r\nimport NativeWebSocketModule from './NativeWebSocketModule';\r\nimport WebSocketEvent from './WebSocketEvent';\r\nimport base64 from 'base64-js';\r\nimport EventTarget from 'event-target-shim';\r\nimport invariant from 'invariant';\r\n\r\ntype ArrayBufferView =\r\n  | Int8Array\r\n  | Uint8Array\r\n  | Uint8ClampedArray\r\n  | Int16Array\r\n  | Uint16Array\r\n  | Int32Array\r\n  | Uint32Array\r\n  | Float32Array\r\n  | Float64Array\r\n  | DataView;\r\n\r\ntype BinaryType = 'blob' | 'arraybuffer';\r\n\r\nconst CONNECTING = 0;\r\nconst OPEN = 1;\r\nconst CLOSING = 2;\r\nconst CLOSED = 3;\r\n\r\nconst CLOSE_NORMAL = 1000;\r\n\r\nconst WEBSOCKET_EVENTS = ['close', 'error', 'message', 'open'];\r\n\r\nlet nextWebSocketId = 0;\r\n\r\n/**\r\n * Browser-compatible WebSockets implementation.\r\n *\r\n * See https://developer.mozilla.org/en-US/docs/Web/API/WebSocket\r\n * See https://github.com/websockets/ws\r\n */\r\nclass WebSocket extends (EventTarget(...WEBSOCKET_EVENTS): any) {\r\n  static CONNECTING: number = CONNECTING;\r\n  static OPEN: number = OPEN;\r\n  static CLOSING: number = CLOSING;\r\n  static CLOSED: number = CLOSED;\r\n\r\n  CONNECTING: number = CONNECTING;\r\n  OPEN: number = OPEN;\r\n  CLOSING: number = CLOSING;\r\n  CLOSED: number = CLOSED;\r\n\r\n  _socketId: number;\r\n  _eventEmitter: NativeEventEmitter;\r\n  _subscriptions: Array<EventSubscription>;\r\n  _binaryType: ?BinaryType;\r\n\r\n  onclose: ?Function;\r\n  onerror: ?Function;\r\n  onmessage: ?Function;\r\n  onopen: ?Function;\r\n\r\n  bufferedAmount: number;\r\n  extension: ?string;\r\n  protocol: ?string;\r\n  readyState: number = CONNECTING;\r\n  url: ?string;\r\n\r\n  constructor(\r\n    url: string,\r\n    protocols: ?string | ?Array<string>,\r\n    options: ?{headers?: {origin?: string, ...}, ...},\r\n  ) {\r\n    super();\r\n    if (typeof protocols === 'string') {\r\n      protocols = [protocols];\r\n    }\r\n\r\n    const {headers = {}, ...unrecognized} = options || {};\r\n\r\n    // Preserve deprecated backwards compatibility for the 'origin' option\r\n    /* $FlowFixMe(>=0.68.0 site=react_native_fb) This comment suppresses an\r\n     * error found when Flow v0.68 was deployed. To see the error delete this\r\n     * comment and run Flow. */\r\n    if (unrecognized && typeof unrecognized.origin === 'string') {\r\n      console.warn(\r\n        'Specifying `origin` as a WebSocket connection option is deprecated. Include it under `headers` instead.',\r\n      );\r\n      /* $FlowFixMe(>=0.54.0 site=react_native_fb,react_native_oss) This\r\n       * comment suppresses an error found when Flow v0.54 was deployed. To see\r\n       * the error delete this comment and run Flow. */\r\n      headers.origin = unrecognized.origin;\r\n      /* $FlowFixMe(>=0.54.0 site=react_native_fb,react_native_oss) This\r\n       * comment suppresses an error found when Flow v0.54 was deployed. To see\r\n       * the error delete this comment and run Flow. */\r\n      delete unrecognized.origin;\r\n    }\r\n\r\n    // Warn about and discard anything else\r\n    if (Object.keys(unrecognized).length > 0) {\r\n      console.warn(\r\n        'Unrecognized WebSocket connection option(s) `' +\r\n          Object.keys(unrecognized).join('`, `') +\r\n          '`. ' +\r\n          'Did you mean to put these under `headers`?',\r\n      );\r\n    }\r\n\r\n    if (!Array.isArray(protocols)) {\r\n      protocols = null;\r\n    }\r\n\r\n    this._eventEmitter = new NativeEventEmitter(NativeWebSocketModule);\r\n    this._socketId = nextWebSocketId++;\r\n    this._registerEvents();\r\n    NativeWebSocketModule.connect(url, protocols, {headers}, this._socketId);\r\n  }\r\n\r\n  get binaryType(): ?BinaryType {\r\n    return this._binaryType;\r\n  }\r\n\r\n  set binaryType(binaryType: BinaryType): void {\r\n    if (binaryType !== 'blob' && binaryType !== 'arraybuffer') {\r\n      throw new Error(\"binaryType must be either 'blob' or 'arraybuffer'\");\r\n    }\r\n    if (this._binaryType === 'blob' || binaryType === 'blob') {\r\n      invariant(\r\n        BlobManager.isAvailable,\r\n        'Native module BlobModule is required for blob support',\r\n      );\r\n      if (binaryType === 'blob') {\r\n        BlobManager.addWebSocketHandler(this._socketId);\r\n      } else {\r\n        BlobManager.removeWebSocketHandler(this._socketId);\r\n      }\r\n    }\r\n    this._binaryType = binaryType;\r\n  }\r\n\r\n  close(code?: number, reason?: string): void {\r\n    if (this.readyState === this.CLOSING || this.readyState === this.CLOSED) {\r\n      return;\r\n    }\r\n\r\n    this.readyState = this.CLOSING;\r\n    this._close(code, reason);\r\n  }\r\n\r\n  send(data: string | ArrayBuffer | ArrayBufferView | Blob): void {\r\n    if (this.readyState === this.CONNECTING) {\r\n      throw new Error('INVALID_STATE_ERR');\r\n    }\r\n\r\n    if (data instanceof Blob) {\r\n      invariant(\r\n        BlobManager.isAvailable,\r\n        'Native module BlobModule is required for blob support',\r\n      );\r\n      BlobManager.sendOverSocket(data, this._socketId);\r\n      return;\r\n    }\r\n\r\n    if (typeof data === 'string') {\r\n      NativeWebSocketModule.send(data, this._socketId);\r\n      return;\r\n    }\r\n\r\n    if (data instanceof ArrayBuffer || ArrayBuffer.isView(data)) {\r\n      NativeWebSocketModule.sendBinary(binaryToBase64(data), this._socketId);\r\n      return;\r\n    }\r\n\r\n    throw new Error('Unsupported data type');\r\n  }\r\n\r\n  ping(): void {\r\n    if (this.readyState === this.CONNECTING) {\r\n      throw new Error('INVALID_STATE_ERR');\r\n    }\r\n\r\n    NativeWebSocketModule.ping(this._socketId);\r\n  }\r\n\r\n  _close(code?: number, reason?: string): void {\r\n    // See https://developer.mozilla.org/en-US/docs/Web/API/CloseEvent\r\n    const statusCode = typeof code === 'number' ? code : CLOSE_NORMAL;\r\n    const closeReason = typeof reason === 'string' ? reason : '';\r\n    NativeWebSocketModule.close(statusCode, closeReason, this._socketId);\r\n\r\n    if (BlobManager.isAvailable && this._binaryType === 'blob') {\r\n      BlobManager.removeWebSocketHandler(this._socketId);\r\n    }\r\n  }\r\n\r\n  _unregisterEvents(): void {\r\n    this._subscriptions.forEach(e => e.remove());\r\n    this._subscriptions = [];\r\n  }\r\n\r\n  _registerEvents(): void {\r\n    this._subscriptions = [\r\n      this._eventEmitter.addListener('websocketMessage', ev => {\r\n        if (ev.id !== this._socketId) {\r\n          return;\r\n        }\r\n        let data = ev.data;\r\n        switch (ev.type) {\r\n          case 'binary':\r\n            data = base64.toByteArray(ev.data).buffer;\r\n            break;\r\n          case 'blob':\r\n            data = BlobManager.createFromOptions(ev.data);\r\n            break;\r\n        }\r\n        this.dispatchEvent(new WebSocketEvent('message', {data}));\r\n      }),\r\n      this._eventEmitter.addListener('websocketOpen', ev => {\r\n        if (ev.id !== this._socketId) {\r\n          return;\r\n        }\r\n        this.readyState = this.OPEN;\r\n        this.protocol = ev.protocol;\r\n        this.dispatchEvent(new WebSocketEvent('open'));\r\n      }),\r\n      this._eventEmitter.addListener('websocketClosed', ev => {\r\n        if (ev.id !== this._socketId) {\r\n          return;\r\n        }\r\n        this.readyState = this.CLOSED;\r\n        this.dispatchEvent(\r\n          new WebSocketEvent('close', {\r\n            code: ev.code,\r\n            reason: ev.reason,\r\n          }),\r\n        );\r\n        this._unregisterEvents();\r\n        this.close();\r\n      }),\r\n      this._eventEmitter.addListener('websocketFailed', ev => {\r\n        if (ev.id !== this._socketId) {\r\n          return;\r\n        }\r\n        this.readyState = this.CLOSED;\r\n        this.dispatchEvent(\r\n          new WebSocketEvent('error', {\r\n            message: ev.message,\r\n          }),\r\n        );\r\n        this.dispatchEvent(\r\n          new WebSocketEvent('close', {\r\n            message: ev.message,\r\n          }),\r\n        );\r\n        this._unregisterEvents();\r\n        this.close();\r\n      }),\r\n    ];\r\n  }\r\n}\r\n\r\nmodule.exports = WebSocket;\r\n"]},"metadata":{},"sourceType":"module"}